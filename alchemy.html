<!DOCTYPE html>
<html>
<head>
<title>Maralie's Alchemy Calculator</title>
<script type="text/JavaScript">
var reagents = [
	"Beetle Scuttle",
	"Blessed Thistle",
	"Blue Entoloma",
	"Bugloss",
	"Butterfly Wing",
	"Columbine",
	"Cornflower",
	"Dragonthorn",
	"Emetic Russula",
	"Fleshfly Larva",
	"Imp Stool",
	"Lady’s Smock",
	"Luminous Russula",
	"Mountain Flower",
	"Mudcrab Chitin",
	"Namira’s Rot",
	"Nightshade",
	"Nirnroot",
	"Scrib Jelly",
	"Spider Egg",
	"Stinkhorn",
	"Torchbug Thorax",
	"Violet Coprinus",
	"Water Hyacinth",
	"Whitecap",
	"Wormwood",
	];

var benefits = [
	"Detection",
	"Gradual Ravage Health",
	"Increase Armor",
	"Increase Damage Taken (vulnerability)",
	"Increase Healing Taken (vitality)",
	"Increase Spell Power",
	"Increase Spell Resist",
	"Increase Weapon Power",
	"Invisible",
	"Lingering Health",
	"Lower Critical Damage (enervation)",
	"Lower Critical Rating (uncertainty)",
	"Lower Spell Resist (breach)",
	"Ravage Health",
	"Ravage Magicka",
	"Ravage Stamina",
	"Ravage Ultimate (cowardice)",
	"Reduce Damage Dealt (maim)",
	"Reduce Damage Taken (protection)",
	"Reduce Healing Taken (defile)",
	"Reduce Physical Resist (fracture)",
	"Reduce Speed (hindrance)",
	"Restore Health",
	"Restore Magicka",
	"Restore Stamina",
	"Speed",
	"Spell Critical",
	"Stun (entrapment)",
	"Unstoppable",
	"Weapon Critical",
	];

var counters = [
	"Invisible", //"Detection",
	"Lingering Health", //"Gradual Ravage Health",
	"Reduce Physical Resist (fracture)", //"Increase Armor",
	"Reduce Damage Taken (protection)", //"Increase Damage Taken (vulnerability)",
	"Reduce Healing Taken (defile)", //"Increase Healing Taken (vitality)",
	"Ravage Ultimate (cowardice)", //"Increase Spell Power",
	"Lower Spell Resist (breach)", //"Increase Spell Resist",
	"Reduce Damage Dealt (maim)", //"Increase Weapon Power",
	"Detection", //"Invisible",
	"Gradual Ravage Health", //"Lingering Health",
	"Weapon Critical", //"Lower Critical Damage (enervation)",
	"Spell Critical", //"Lower Critical Rating (uncertainty)",
	"Increase Spell Resist", //"Lower Spell Resist (breach)",
	"Restore Health", //"Ravage Health",
	"Restore Magicka", //"Ravage Magicka",
	"Restore Stamina", //"Ravage Stamina",
	"Increase Spell Power", //"Ravage Ultimate (cowardice)",
	"Increase Weapon Power", //"Reduce Damage Dealt (maim)",
	"Increase Damage Taken (vulnerability)", //"Reduce Damage Taken (protection)",
	"Increase Healing Taken (vitality)", //"Reduce Healing Taken (defile)",
	"Increase Armor", //"Reduce Physical Resist (fracture)",
	"Speed", //"Reduce Speed (hindrance)",
	"Ravage Health", //"Restore Health",
	"Ravage Magicka", //"Restore Magicka",
	"Ravage Stamina", //"Restore Stamina",
	"Reduce Speed (hindrance)", //"Speed",
	"Lower Critical Rating (uncertainty)", //"Spell Critical",
	"Unstoppable", //"Stun (entrapment)",
	"Stun (entrapment)", //"Unstoppable",
	"Lower Critical Damage (enervation)", //"Weapon Critical",
	];

var reagents_benefits = 	[
	["Beetle Scuttle", [
		"Lower Spell Resist (breach)",
		"Reduce Damage Taken (protection)",
		"Increase Armor",
		"Increase Healing Taken (vitality)",
		]],
	["Blessed Thistle", [
		"Restore Stamina",
		"Ravage Health",
		"Increase Weapon Power",
		"Speed",
		]],
	["Blue Entoloma", [
		"Ravage Magicka",
		"Restore Health",
		"Ravage Ultimate (cowardice)",
		"Invisible",
		]],
	["Bugloss", [
		"Increase Spell Resist",
		"Ravage Ultimate (cowardice)",
		"Restore Health",
		"Restore Magicka",
		]],
	["Butterfly Wing", [
		"Restore Health",
		"Lingering Health",
		"Lower Critical Rating (uncertainty)",
		"Increase Healing Taken (vitality)",
		]],
	["Columbine", [
		"Restore Health",
		"Restore Stamina",
		"Restore Magicka",
		"Unstoppable",
		]],
	["Cornflower", [
		"Restore Magicka",
		"Ravage Health",
		"Increase Spell Power",
		"Detection",
		]],
	["Dragonthorn", [
		"Increase Weapon Power",
		"Reduce Physical Resist (fracture)",
		"Restore Stamina",
		"Weapon Critical",
		]],
	["Emetic Russula", [
		"Ravage Health",
		"Ravage Stamina",
		"Ravage Magicka",
		"Stun (entrapment)",
		]],
	["Fleshfly Larva", [
		"Ravage Stamina",
		"Gradual Ravage Health",
		"Increase Damage Taken (vulnerability)",
		"Increase Healing Taken (vitality)",
		]],
	["Imp Stool", [
		"Reduce Damage Dealt (maim)",
		"Increase Armor",
		"Ravage Stamina",
		"Lower Critical Damage (enervation)",
		]],
	["Lady’s Smock", [
		"Increase Spell Power",
		"Lower Spell Resist (breach)",
		"Restore Magicka",
		"Spell Critical",
		]],
	["Luminous Russula", [
		"Ravage Stamina",
		"Restore Health",
		"Reduce Damage Dealt (maim)",
		"Reduce Speed (hindrance)",
		]],
	["Mountain Flower", [
		"Increase Armor",
		"Reduce Damage Dealt (maim)",
		"Restore Health",
		"Restore Stamina",
		]],
	["Mudcrab Chitin", [
		"Increase Spell Resist",
		"Reduce Damage Taken (protection)",
		"Increase Armor",
		"Reduce Healing Taken (defile)",
		]],
	["Namira’s Rot", [
		"Spell Critical",
		"Invisible",
		"Speed",
		"Unstoppable",
		]],
	["Nightshade", [
		"Ravage Health",
		"Gradual Ravage Health",
		"Reduce Damage Taken (protection)",
		"Reduce Healing Taken (defile)",
		]],
	["Nirnroot", [
		"Ravage Health",
		"Lower Critical Damage (enervation)",
		"Lower Critical Rating (uncertainty)",
		"Invisible",
		]],
	["Scrib Jelly", [
		"Ravage Magicka",
		"Increase Damage Taken (vulnerability)",
		"Speed",
		"Lingering Health",
		]],
	["Spider Egg", [
		"Reduce Speed (hindrance)",
		"Lingering Health",
		"Invisible",
		"Reduce Healing Taken (defile)",
		]],
	["Stinkhorn", [
		"Reduce Physical Resist (fracture)",
		"Increase Weapon Power",
		"Ravage Health",
		"Ravage Stamina",
		]],
	["Torchbug Thorax", [
		"Reduce Physical Resist (fracture)",
		"Detection",
		"Lower Critical Damage (enervation)",
		"Increase Healing Taken (vitality)",
		]],
	["Violet Coprinus", [
		"Lower Spell Resist (breach)",
		"Increase Spell Power",
		"Ravage Health",
		"Ravage Magicka",
		]],
	["Water Hyacinth", [
		"Restore Health",
		"Weapon Critical",
		"Spell Critical",
		"Stun (entrapment)",
		]],
	["Whitecap", [
		"Ravage Ultimate (cowardice)",
		"Increase Spell Resist",
		"Ravage Magicka",
		"Detection",
		]],
	["Wormwood", [
		"Weapon Critical",
		"Detection",
		"Reduce Speed (hindrance)",
		"Unstoppable",
		]],
	];

var benefits_reagents = [];

function produce_benefits_reagents_list() {
	benefits_reagents = [];
	for (var b_idx in benefits) {
		benefit_name = benefits[b_idx]
		benefits_reagents.push([benefit_name,[]]);
		}
	for (var rb_idx in reagents_benefits) {
		reagent_benefits = reagents_benefits[rb_idx];
		reagent_name = reagent_benefits[0];
		benefit_set = reagent_benefits[1];
		for (var idx in benefit_set) {
			benefit_name = benefit_set[idx];
			index = benefits.indexOf(benefit_name);
			benefits_reagents[index][1].push(reagent_name);
			}
		}
	return benefits_reagents;
	}

function collate_benefits() {
	checked_benefits = document.querySelectorAll('*[name="benefit"]:checked');
	collated = [];
	for (let benefit of checked_benefits.keys()) {
		collated.push(checked_benefits.item(benefit).value);
		}
	return collated;
	}

function populate_benefits_list() {
	benefits_listing = document.getElementById("benefits");
	benefits_listing.innerHTML = '';
	for (i in benefits) {
		benefit_item = '<input type="checkbox" name="benefit" value="' + benefits[i] + '">' + benefits[i] + "</input><br/>\n";
		benefits_listing.innerHTML += benefit_item;
		};
	return true;
	}

function benefits_for_reagent(reagent_name) {
	i = reagents.indexOf(reagent_name);
	reagent_benefits = reagents_benefits[i];
	benefits_list = reagent_benefits[1];
	return benefits_list;
	}

function reagents_for_benefit(benefit_name) {
	i = benefits.indexOf(benefit_name);
	benefit_reagents = benefits_reagents[i];
	reagents_list = benefit_reagents[1];
	return reagents_list;
	}

function two_reagent_benefits(reagent_a, reagent_b) {
	mixture_benefits = [];
	reagent_a_benefits = benefits_for_reagent(reagent_a);
	reagent_b_benefits = benefits_for_reagent(reagent_b);
	for (a in reagent_a_benefits) {
		for (b in reagent_b_benefits) {
			a_benefit = reagent_a_benefits[a];
			b_benefit = reagent_b_benefits[b];
			if (a_benefit == b_benefit) {
				mixture_benefits.push(a_benefit);
				}
			}
		}
	return [[reagent_a, reagent_b], mixture_benefits];
	}

function two_reagent_concoctions(requested_benefits) {
	// Short-list concoctions with any of the required benefits
	short_list = [];
	for (var b_idx in requested_benefits) {
		benefit_position = benefits.indexOf(requested_benefits[b_idx]);
		benefit_reagents = benefits_reagents[benefit_position];
		required_reagents = benefit_reagents[1];
		// add a mix of each reagent with each remaining reagent
		for (ra = 0; ra < required_reagents.length - 1; ra++) {
			reagent_a = required_reagents[ra];
			for (rb = ra+1; rb < required_reagents.length; rb++) {
				reagent_b = required_reagents[rb];
				concoction_benefits = two_reagent_benefits(reagent_a, reagent_b);
				short_list.push(concoction_benefits);
				}
			}
		}

	// Cull the short list of concoctions that don't provide all benefits
	concoctions = [];
	for (sl in short_list) {
		concoction = short_list[sl];
		concoction_benefits = concoction[1];
		pass = true;
		for (b_idx in requested_benefits) {
			benefit_name = requested_benefits[b_idx];
			if (!concoction_benefits.includes(benefit_name)) {
				pass = false;
				}
			}
		if (pass) {
			concoctions.push(concoction);
			}
		}
	return concoctions;
	}
</script>
</head>
<body>
<div id="calculator-body">
<div id="benefits">
</div>
<button name="Clear" value="Clear" onClick="JavaScript:populate_benefits_list()">Clear</button>
<div id="reagents">
</div>
</div>
</body>
<script type="text/JavaScript">
populate_benefits_list();
produce_benefits_reagents_list();
</script>
</html>
